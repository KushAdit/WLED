<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
	<meta name="viewport" content="width=500">
	<title>LED Settings</title>
	<script>
    var d=document,laprev=55;
		function B()
		{
			window.open("/settings","_self");
		}
		function S(){GetV();setABL();}
    function enABL()
    {
      var en = d.getElementById('able').checked;
      d.Sf.LA.value = (en) ? laprev:0;
      d.getElementById('abl').style.display = (en) ? 'inline':'none';
      d.getElementById('psu2').style.display = 'none';
      if (d.Sf.LA.value > 0) setABL();
    }
    function enLA()
    {
      var val = d.Sf.LAsel.value;
      d.Sf.LA.value = val;
      d.getElementById('LAdis').style.display = (val == 50) ? 'inline':'none';
      UI();
    }
    function setABL()
    {
      d.getElementById('able').checked = true;
      d.Sf.LAsel.value = 50;
      switch (parseInt(d.Sf.LA.value)) {
        case 0: d.getElementById('able').checked = false; enABL(); break;
        case 30: d.Sf.LAsel.value = 30; break;
        case 35: d.Sf.LAsel.value = 35; break;
        case 55: d.Sf.LAsel.value = 55; break;
        case 255: d.Sf.LAsel.value = 255; break;
        default: d.getElementById('LAdis').style.display = 'inline';
      }
      UI();
    }
		function UI()
		{
			var myC = d.querySelectorAll('.wc'),
			l = myC.length;
			for (i = 0; i < l; i++) {
				myC[i].style.display = (d.getElementById('rgbw').checked) ? 'inline':'none';
			}
	  if (d.Sf.LA.value == 255) laprev = 12;
	  else if (d.Sf.LA.value > 0) laprev = d.Sf.LA.value;

			var val = Math.ceil((100 + d.Sf.LC.value * laprev)/500)/2;
			val = (val > 5) ? Math.ceil(val) : val;
			var s = "";
      var is12V = (d.Sf.LAsel.value == 30);
      var isWS2815 = (d.Sf.LAsel.value == 255);
			if (val < 1.02 && !is12V && !isWS2815)
			{
				s = "ESP 5V pin with 1A USB supply";
			} else
			{
        		s += is12V ? "12V ": isWS2815 ? "WS2815 12V " : "5V ";
				s += val;
				s += "A supply connected to LEDs";
			}
      var val2 = Math.ceil((100 + d.Sf.LC.value * laprev)/1500)/2;
      val2 = (val2 > 5) ? Math.ceil(val2) : val2;
      var s2 = "(for most effects, ~";
      s2 += val2;
      s2 += "A is enough)<br>";
			d.getElementById('psu').innerHTML = s;
			d.getElementById('psu2').innerHTML = isWS2815 ? "" : s2;

			var LCW = 1
			var LCH = parseInt(d.Sf.LC.value, 10)

			d.getElementById('submitButton').disabled = false;
			d.getElementById('submitButton2').disabled = false;
		}
		function GetV()
		{
			//values injected by server while sending HTML
		}
	</script>
	<style>
		@import url("style.css");
	</style>
</head>
<body onload="S()">
  <div style='text-align:left;display:inline-block;color:#eaeaea;min-width:340px;'>
	<form id="form_s" name="Sf" method="post">
		<button type="button" onclick="B()">Back</button><br><button type="submit">Save</button><hr><hr>
    <h1 style='text-align:center;color: #e8ec1f;'>ON STARTUP</h1>		
    <table>
			<tr>
				<td style='width:220px;'><b>Turn LEDs on:</b>
				</td>
			<td>
				<input type="checkbox" name="BO">
      </td></tr>
      <tr>
      <td style='width:220px'><b>Default brightness (0-255):</b>
      </td>
    <td>
      <input name="CA" type="number" min="0" max="255" required>
    </td></tr></table><br>
  <table>
    <tr>
      <td style='width:220px'><b>Apply preset:</b>
      </td>
    <td>
      <input name="BP" type="number" min="0" max="250" required>
    </td></tr>
    <tr><td>OR</td></tr>
    <tr>
      <td style='width:220px'><b>Cycle presets:</b>
      </td>
    <td>
      <input type="checkbox" name="PC">
    </td></tr>
    </table><br><hr>
    <h1 style='text-align:center;color: #ff5e00;'>Configuration</h1>
    <table>
      <tr>
        <td style='width:220px'><b>LED count: </b>
        </td>
      <td>
        <input name="LC" type="number" min="1" max="1500" oninput="UI()" required>
      </td></tr>
      <tr>
        <td style='width:220px'><b>Reverse Direction: </b>
        </td>
      <td>
        <input type="checkbox" name="RV">
      </td></tr>
    </tr>
    <tr>
      <td style='width:220px'><b>Limit Power: </b>
      </td>
    <td>
      <input type="checkbox" name="ABen" onchange="enABL()" id="able">
    </td></tr>
    <tr id="abl">
      <td style='width:220px'><b>Maximum Current (mA): </b>
      </td>
    <td>
      <input name="MA" type="number" min="250" max="65000" oninput="UI()" required>
    </td></tr>
      </table><br><hr>
      <h1 style='text-align:center;color: #09ff00;'>Timer Config</h1> 
      <table>
        <tr>
          <td style='width:220px'><b>Time Period (min): </b>
          </td>
        <td>
          <input name="TL" type="number" min="1" max="255" required>
        </td></tr>
        <tr>
          <td style='width:220px'><b>Target Brightness (0-255): </b>
          </td>
        <td>
          <input name="TB" type="number" min="0" max="255" required>
        </td></tr>
      </tr>
      <tr>
        <td style='width:220px'><b>Mode: </b>
        </td>
      <td>
        <select name="TW">
          <option value="0">Wait and set</option>
          <option value="1">Fade</option>
          <option value="2">Fade Color</option>
          <option value="3">Sunrise</option>
        </select>
      </td></tr>
        </table><hr><hr>

<span class="pow" hidden></span>
      <select name="LAsel" onchange="enLA()" hidden>
        <option value="55" selected>5V default (55mA)</option>
        <option value="35">5V efficient (35mA)</option>
        <option value="30">12V (30mA)</option>
        <option value="255">WS2815 (12mA)</option>
        <option value="50">Custom</option>
      </select>
      <span id="LAdis" hidden><input name="LA" id="la" hidden></span>

     <span id="psu" hidden></span>
		<span id="psu2" hidden></span>
			<input name="LCW"hidden>
			<input name="LCH" hidden>
      <input hidden name="LCWHS" >
      <input type="checkbox" name="EW" onchange=UI() id="rgbw" hidden>
    <span class="wc">
    <select name=AW>
      <option value=0>None</option>
      <option value=1>Brighter</option>
      <option value=2>Accurate</option>
      <option value=3>Dual</option>
      <option value=4>Legacy</option>
    </select></span>
		<select name="CO" hidden>
			<option value=0>GRB</option>
      <option value=1>RGB</option>
      <option value=2>BRG</option>
      <option value=3>RBG</option>
      <option value=4>BGR</option>
      <option value=5>GBR</option>
		</select>
	<input type="checkbox" name="GC" hidden>
		<input type="checkbox" name="GB" hidden>
		<input name="BF" hidden>
		<input hidden name="TF">
		<input name="TD" hidden>
		<input hidden name="PF">
		<select name="PB" hidden>
			<option value="0">Linear (wrap if moving)</option>
			<option value="1">Linear (always wrap)</option>
			<option value="2">Linear (never wrap)</option>
			<option value="3">None (not recommended)</option>
		</select>
		<input hidden name="SL">
		<button type="button" onclick="B()">Back</button><br><button type="submit">Save</button>
  </form>
</div>
</body>
</html>